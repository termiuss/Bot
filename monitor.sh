
#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞

echo "ü§ñ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Telegram –±–æ—Ç–∞"
echo "============================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
echo "üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞:"
if systemctl is-active --quiet memo-bot; then
    echo "‚úÖ –°–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω"
else
    echo "‚ùå –°–µ—Ä–≤–∏—Å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
echo -e "\nüîç –ü—Ä–æ—Ü–µ—Å—Å—ã:"
pgrep -f "python.*main.py" > /dev/null
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å Python –∑–∞–ø—É—â–µ–Ω"
    echo "PID: $(pgrep -f "python.*main.py")"
else
    echo "‚ùå –ü—Ä–æ—Ü–µ—Å—Å Python –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
echo -e "\nüíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:"
if pgrep -f "python.*main.py" > /dev/null; then
    ps -p $(pgrep -f "python.*main.py") -o pid,pcpu,pmem,cmd --no-headers
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo -e "\nüóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:"
if [ -f "data/memo_bot.db" ]; then
    echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    echo "–†–∞–∑–º–µ—Ä: $(du -h data/memo_bot.db | cut -f1)"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
    sqlite3 data/memo_bot.db "PRAGMA integrity_check;" | head -1
else
    echo "‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
echo -e "\nüìã –õ–æ–≥–∏:"
if [ -f "memo_bot.log" ]; then
    echo "‚úÖ –§–∞–π–ª –ª–æ–≥–æ–≤ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    echo "–†–∞–∑–º–µ—Ä: $(du -h memo_bot.log | cut -f1)"
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏:"
    tail -20 memo_bot.log | grep -i error | tail -3
else
    echo "‚ö†Ô∏è –§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
echo -e "\nüíΩ –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ:"
df -h . | tail -1 | awk '{print "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: " $3 "/" $2 " (" $5 ")"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
echo -e "\n‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:"
uptime

echo -e "\n============================"
echo "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω $(date)"
